#!/bin/sh
#
# Copyright (c) 2018 Mark Heily <mark@heily.com>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#

if [ "$1" = "--as-system-manager" ] ; then
    shift
    export PREFIX=/lib/jmf
    export BINDIR=/bin
    export RUNSTATEDIR=/lib/jmf/run
    exec ./configure $*
fi

prefix=${PREFIX:-/usr/local}
bindir=${BINDIR:-${prefix}/bin}
sbindir=${SBINDIR:-${prefix}/sbin}
pkgconfigdir=${PKGCONFIGDIR:-${prefix}/etc/jmf}
datarootdir=${DATAROOTDIR:-${prefix}/share}
localstatedir=${LOCALSTATEDIR:-${prefix}/var}
runstatedir=${RUNSTATEDIR:-${prefix}/var/run}

cat >config.mk <<EOF
# DO NOT EDIT -- automatically generated by ./configure

PREFIX := $prefix
BINDIR := $bindir
SBINDIR := $sbindir
PKGCONFIGDIR := $pkgconfigdir
DATAROOTDIR := $datarootdir
LOCALSTATEDIR := $localstatedir
RUNSTATEDIR := $runstatedir
EOF

cat >config.h <<EOF
/* DO NOT EDIT -- automatically generated by ./configure */

#ifndef _CONFIG_H
#define _CONFIG_H

static const struct {
    const char *prefix;
    const char *bindir;
    const char *sbindir;
    const char *pkgconfigdir;
    const char *datarootdir;
    const char *localstatedir;
    const char *runstatedir;
} compile_time_option = {
    .prefix = "${prefix}",
    .bindir = "${bindir}",
    .sbindir = "${sbindir}",
    .pkgconfigdir = "${pkgconfigdir}",
    .datarootdir = "${datarootdir}",
    .localstatedir = "${localstatedir}",
    .runstatedir = "${runstatedir}"
};

#endif /* _CONFIG_H */
EOF